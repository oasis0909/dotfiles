#+----------------------------------------------------------------------------------------+
#  Prefix Key
#+----------------------------------------------------------------------------------------+
# プレフィックスキーを設定
set-option -g prefix C-t
unbind-key C-b
bind-key C-t send-prefix

#+----------------------------------------------------------------------------------------+
#  Session Options
#+----------------------------------------------------------------------------------------+
# 新しいウィンドウ/ペインのベース番号
set-option -g base-index 0
set-option -g pane-base-index 1

# 全てのベルを無視
set-option -g bell-action none

# 各セッションで保持するバッファ数
set-option -g buffer-limit 32

# 256色端末を使用
## Mac
set-option -g default-terminal "screen-256color"
## Linux
# set-option -g default-terminal "xterm-256color"

# ウィンドウ履歴で保持される最大行数
set-option -g history-limit 10000

# ウィンドウ名の変更回避
set-option -g allow-rename off

# Escapeキー入力時の待ち時間(0.5秒)をキャンセル
set-option -s escape-time 0

#+----------------------------------------------------------------------------------------+
#  Status Line
#+----------------------------------------------------------------------------------------+
set-option -g status on

set -g status-left '#[fg=colour223,bg=colour180,bold] #(hostname -s)#[deafult] #S #[fg=colour180,bg=colour238,nobold]⮀#[fg=colour245,bg=colour238,bold] #(whoami) #[fg=colour238,bg=colour234,nobold]⮀'
set -g status-right '#[fg=colour241]#H ⮃ #I:#P #[fg=colour221,bg=colour234,nobold]⮂#[fg=colour88,bg=colour221] Mem #(used-mem)%% ⮃ LAve.[#(loadaverage)] #[fg=colour255,bg=colour221,bold]⮂#[fg=colour31,bg=colour255,bold] %Y/%m/%d(%a)%H:%M#[default]'
set -g window-status-format "#[fg=white,bg=colour234] #I #W "
set -g window-status-current-format "#[fg=colour234,bg=colour139]⮀#[fg=colour183,bg=colour139,noreverse,bold] #I ⮁ #W #[fg=colour139,bg=colour234,bold]⮀"
set -g message-attr bold
set -g message-fg white
set -g message-bg red

# ステータスライン更新間隔(秒)
set -g status-interval 1
# ステータスライン長さ:左側
set -g status-left-length 120
# ステータスライン長さ:右側
set -g status-right-length 120
## ステータスラインカスタム関連
set -g status-bg black
set -g status-fg white
set -g status-attr dim
set -g status-left-length 32
set -g status-right-length 150
set -g window-status-activity-attr bold
set -g pane-border-fg colour245
set -g pane-border-bg green
set -g pane-active-border-fg red
set -g pane-active-border-bg green

# タイトル表示設定
# example	 www1.hoge.com→www1のみ表示。
# set-option -g set-titles-string "@#(hostname | sed 's/\\\\..*//')"
set-option -g set-titles on

#+----------------------------------------------------------------------------------------+
#  Window Options
#+----------------------------------------------------------------------------------------+
# ウィンドウを実行コマンド名で自動リネーム
set-window-option -g automatic-rename off
# スクロールモード、コピーモード、選択モードで vi のキーバインドを使う
set-window-option -g mode-keys vi
# ウィンドウで動作があるとステータスラインでハイライト
set-window-option -g monitor-activity on

#+----------------------------------------------------------------------------------------+
#  Bind Keys
#+----------------------------------------------------------------------------------------+
# C-Right,C-Leftでウィンドウ切り替え
# * Ctrl and arrow keys doesn't work in putty! What do I do?
# http://tmux.svn.sourceforge.net/viewvc/tmux/trunk/FAQ
set -g terminal-overrides "xterm*:kLFT5=\eOD:kRIT5=\eOC:kUP5=\eOA:kDN5=\eOB:smkx@:rmkx@:colors=256"
bind-key -n C-Right next-window
bind-key -n C-Left previous-window

# ウィンドウ移動
bind t last-window
bind C-t last-window
bind -r C-n next-window
bind -r C-p previous-window
# ウィンドウ選択画面
bind Space choose-window
# 新ウィンドウ作成
bind c new-window
bind C-c new-window

# 分割していたペインそれぞれをWindowに
bind b break-pane
# ペインの縦分割
bind h split-window -v
# ペインの横分割
bind v split-window -h
# ペイン移動
bind -r C-h select-pane -L
bind -r C-j select-pane -D
bind -r C-k select-pane -U
bind -r C-l select-pane -R
# ペイン削除
bind C-d kill-pane
# ペインリサイズ関連vi風
bind -r H resize-pane -L 6
bind -r J resize-pane -D 6
bind -r K resize-pane -U 6
bind -r L resize-pane -R 6
bind s swap-pane -U

# ペイン終了
#bind k kill-pane
bind k confirm-before -p "kill-pane ? (y/n)" kill-pane
# ウィンドウ終了
#bind K kill-window
bind K confirm-before -p "kill-window ? (y/n)" kill-window
# ペイン番号表示
bind i display-panes
# コピーモード
bind-key y copy-mode \; display "(Copy mode)"
# ペーストモード
bind p paste-buffer

# vでマーク開始
set-option -g default-command "shell >/dev/null 2>&1; reattach-to-user-namespace -l zsh"
bind-key -T copy-mode-vi v send-keys -X begin-selection
# yでヤンク + クリップボードへコピー
bind-key -T copy-mode-vi y send-keys -X copy-pipe-and-cancel "reattach-to-user-namespace pbcopy"
bind-key -T copy-mode-vi Enter send-keys -X copy-pipe-and-cancel "reattach-to-user-namespace pbcopy"

# 複数ペインへの同時入力 
set-option -g synchronize-panes off
bind-key e set-window-option synchronize-panes on \; set-option -g status-bg colour172 \; display 'Synchronize begin'
bind-key E set-window-option synchronize-panes off \; set-option -g status-bg black \; display 'Synchronize end'

# manを新規ペインで開き、終了する際にペインを閉じる
bind-key m command-prompt "split-window -p 65 'exec man %%'"

# ssh接続時に新規ウィンドウ/ペインで開く
unbind s
# 新しいウィンドウ
bind-key s command-prompt "new-window -n %1 'TERM=xterm-256color ssh -A %1'"
# bind-key s command-prompt "new-window -n %1 'TERM=xterm ssh -A %1'"
# ペイン縦分割で開く
bind-key S command-prompt "split-window -h 'TERM=xterm-256color ssh -A %1'"
# ペイン横分割で開く
bind-key T command-prompt "split-window 'TERM=xterm-256color ssh -A %1'"
# 設定リロード
bind r source-file ~/.tmux.conf ; display-message "Reload Config!!"

